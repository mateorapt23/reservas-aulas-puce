<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Sistema LTIC{% endblock %}</title>

    <!-- Google Font: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

    <!-- Tailwind + DaisyUI -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'ui-sans-serif'],
                    },
                }
            },
            daisyui: {
                themes: [],
            }
        }
    </script>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.12.10/dist/full.min.css" rel="stylesheet"/>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <style>
        .sidebar-collapsed {
            width: 5rem;
        }
        .sidebar-expanded {
            width: 18rem;
        }
        .sidebar-transition {
            transition: width 0.3s ease-in-out;
        }
        .sidebar-no-transition {
            transition: none;
        }
        .menu-text {
            opacity: 1;
            transition: opacity 0.2s ease-in-out;
        }
        .menu-text-hidden {
            opacity: 0;
            width: 0;
            overflow: hidden;
        }
        .menu-text-no-transition {
            transition: none;
        }
        .collapse-btn {
            opacity: 1;
            transition: opacity 0.3s ease-in-out;
        }
        .collapse-btn-hidden {
            opacity: 0;
            pointer-events: none;
        }
        .collapse-btn-no-transition {
            transition: none;
        }
        body {
            overflow-x: hidden;
        }
        .sidebar-collapsed .menu {
            overflow-x: hidden;
        }
        .sidebar-collapsed #footer-container {
            justify-content: space-between;
        }
        .sidebar-collapsed #logout-btn {
            margin-left: auto;
        }
    </style>
</head>

<body class="bg-[#0f172a] font-sans">

<div class="flex h-screen overflow-hidden">
    
    <!-- SIDEBAR -->
    <aside id="sidebar" class="
        sidebar-expanded sidebar-transition
        min-h-screen
        bg-gradient-to-b from-[#0B1120] to-[#020617]
        text-gray-300
        shadow-[inset_0_1px_0_rgba(255,255,255,0.05)]
        flex flex-col
        hidden lg:flex
        relative
        cursor-pointer
    ">

        <!-- LOGO -->
        <div id="logo-section" class="px-4 py-6 flex items-center gap-3 justify-between">
            <div class="flex items-center gap-3">
                <div class="
                    w-11 h-11 rounded-xl flex-shrink-0
                    bg-gradient-to-br from-indigo-500 to-indigo-600
                    flex items-center justify-center
                    text-white font-semibold text-lg
                    shadow-[0_0_15px_rgba(99,102,241,0.5)]
                ">
                    GA
                </div>
                <div class="menu-text">
                    <p class="text-lg font-semibold text-gray-100 leading-tight whitespace-nowrap">
                        LTIC
                    </p>
                    <p class="text-xs text-gray-400 tracking-wide whitespace-nowrap">
                        Gestión de Aulas
                    </p>
                </div>
            </div>
            
            <!-- Botón de colapsar -->
            <button 
                id="toggle-sidebar"
                class="
                    collapse-btn
                    w-8 h-8 rounded-lg
                    hover:bg-white/10
                    text-gray-400 hover:text-white
                    flex items-center justify-center
                    transition-all duration-200
                    flex-shrink-0
                "
                onclick="event.stopPropagation()"
            >
                <i data-lucide="chevron-left" class="w-5 h-5"></i>
            </button>
        </div>

        <!-- MENU -->
        <ul class="menu px-4 text-[15px] font-medium gap-1 overflow-y-auto flex-1">

            <!-- RESERVAS -->
            <li class="menu-title text-xs tracking-widest uppercase text-gray-500">
                <span class="menu-text">Reservas</span>
            </li>

            <li>
                <a href="/reservas/nueva/"
                   class="hover:bg-white/5 hover:text-white rounded-xl transition-all flex items-center gap-3 justify-start"
                   title="Nueva reserva"
                   onclick="event.stopPropagation()">
                    <i data-lucide="calendar-plus" class="w-5 h-5 flex-shrink-0"></i>
                    <span class="menu-text whitespace-nowrap">Nueva reserva</span>
                </a>
            </li>

            <li>
                <a href="{% url 'reservas:lista_reservas' %}"
                   class="hover:bg-white/5 hover:text-white rounded-xl transition-all flex items-center gap-3 justify-start"
                   title="Lista de reservas"
                   onclick="event.stopPropagation()">
                    <i data-lucide="clipboard-list" class="w-5 h-5 flex-shrink-0"></i>
                    <span class="menu-text whitespace-nowrap">Lista de reservas</span>
                </a>
            </li>

            <!-- CALENDARIO -->
            <li class="menu-title text-xs tracking-widest uppercase text-gray-500 mt-4">
                <span class="menu-text">Calendario</span>
            </li>

            <li>
                <a href="{% url 'calendario:agenda_por_aula' %}"
                   class="hover:bg-white/5 hover:text-white rounded-xl transition-all flex items-center gap-3 justify-start"
                   title="Agenda por aula"
                   onclick="event.stopPropagation()">
                    <i data-lucide="calendar" class="w-5 h-5 flex-shrink-0"></i>
                    <span class="menu-text whitespace-nowrap">Agenda por aula</span>
                </a>
            </li>

            <!-- CONFIGURACIÓN -->
            <li class="menu-title text-xs tracking-widest uppercase text-gray-500 mt-4">
                <span class="menu-text">Configuración</span>
            </li>

            <li>
                <a href="{% url 'configuracion:requerimientos' %}"
                   class="hover:bg-white/5 hover:text-white rounded-xl transition-all flex items-center gap-3 justify-start"
                   title="Requerimientos"
                   onclick="event.stopPropagation()">
                    <i data-lucide="box" class="w-5 h-5 flex-shrink-0"></i>
                    <span class="menu-text whitespace-nowrap">Requerimientos</span>
                </a>
            </li>

            <li>
                <a href="{% url 'configuracion:catedras' %}"
                   class="hover:bg-white/5 hover:text-white rounded-xl transition-all flex items-center gap-3 justify-start"
                   title="Cátedras"
                   onclick="event.stopPropagation()">
                    <i data-lucide="book-open" class="w-5 h-5 flex-shrink-0"></i>
                    <span class="menu-text whitespace-nowrap">Cátedras</span>
                </a>
            </li>

            <li>
                <a href="{% url 'configuracion:aulas' %}"
                   class="hover:bg-white/5 hover:text-white rounded-xl transition-all flex items-center gap-3 justify-start"
                   title="Aulas"
                   onclick="event.stopPropagation()">
                    <i data-lucide="door-open" class="w-5 h-5 flex-shrink-0"></i>
                    <span class="menu-text whitespace-nowrap">Aulas</span>
                </a>
            </li>

        </ul>

        <!-- FOOTER CON USUARIO Y LOGOUT -->
        <div class="p-4 border-t border-white/10">
            <div class="flex items-center gap-2" id="footer-container">
                <div class="flex items-center gap-3 flex-1 min-w-0">
                    <div class="w-8 h-8 rounded-lg bg-indigo-500/20 flex items-center justify-center flex-shrink-0">
                        <i data-lucide="user" class="w-4 h-4 text-indigo-400"></i>
                    </div>
                    <div class="menu-text min-w-0">
                        <p class="text-sm font-medium text-gray-200 truncate">
                            {{ user.username }}
                        </p>
                        <p class="text-xs text-gray-500">
                            Administrador
                        </p>
                    </div>
                </div>
                <a 
                    href="{% url 'usuarios:logout' %}"
                    id="logout-btn"
                    class="collapse-btn btn btn-ghost btn-sm btn-square text-gray-400 hover:text-red-400 hover:bg-red-500/10 transition-all flex-shrink-0"
                    title="Cerrar sesión"
                    onclick="return confirm('¿Cerrar sesión?')"
                >
                    <i data-lucide="log-out" class="w-4 h-4"></i>
                </a>
            </div>
        </div>

    </aside>

    <!-- CONTENIDO PRINCIPAL -->
    <div class="flex-1 flex flex-col overflow-hidden">

        <!-- Navbar móvil -->
        <div class="lg:hidden navbar bg-[#020617] text-gray-200">
            <button id="mobile-menu-btn" class="btn btn-ghost text-xl">☰</button>
            <span class="ml-2 font-medium tracking-wide">LTIC · Gestión de Aulas</span>
        </div>

        <!-- MAIN -->
        <main class="flex-1 p-8 text-gray-200 overflow-auto">
            {% block content %}
            {% endblock %}
        </main>
    </div>

</div>

<script>
    // Inicializar iconos Lucide
    lucide.createIcons();

    // Toggle sidebar desktop
    const sidebar = document.getElementById('sidebar');
    const toggleBtn = document.getElementById('toggle-sidebar');
    const menuTexts = document.querySelectorAll('.menu-text');
    
    let isCollapsed = false;

    function toggleSidebar() {
        isCollapsed = !isCollapsed;
        
        if (isCollapsed) {
            sidebar.classList.remove('sidebar-expanded');
            sidebar.classList.add('sidebar-collapsed');
            sidebar.style.cursor = 'pointer';
            menuTexts.forEach(text => {
                text.classList.add('menu-text-hidden');
            });
            toggleBtn.classList.add('collapse-btn-hidden');
            localStorage.setItem('sidebarCollapsed', 'true');
        } else {
            sidebar.classList.remove('sidebar-collapsed');
            sidebar.classList.add('sidebar-expanded');
            sidebar.style.cursor = 'default';
            menuTexts.forEach(text => {
                text.classList.remove('menu-text-hidden');
            });
            toggleBtn.classList.remove('collapse-btn-hidden');
            localStorage.setItem('sidebarCollapsed', 'false');
        }
    }

    function restoreSidebarState() {
        const savedState = localStorage.getItem('sidebarCollapsed');
        if (savedState === 'true') {
            sidebar.classList.add('sidebar-no-transition');
            menuTexts.forEach(text => {
                text.classList.add('menu-text-no-transition');
            });
            toggleBtn.classList.add('collapse-btn-no-transition');
            
            isCollapsed = true;
            sidebar.classList.remove('sidebar-expanded');
            sidebar.classList.add('sidebar-collapsed');
            sidebar.style.cursor = 'pointer';
            menuTexts.forEach(text => {
                text.classList.add('menu-text-hidden');
            });
            toggleBtn.classList.add('collapse-btn-hidden');
            
            setTimeout(() => {
                sidebar.classList.remove('sidebar-no-transition');
                menuTexts.forEach(text => {
                    text.classList.remove('menu-text-no-transition');
                });
                toggleBtn.classList.remove('collapse-btn-no-transition');
            }, 50);
        }
    }

    restoreSidebarState();

    toggleBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        toggleSidebar();
    });

    sidebar.addEventListener('click', (e) => {
        if (isCollapsed) {
            if (!e.target.closest('a')) {
                toggleSidebar();
            }
        }
    });

    const mobileMenuBtn = document.getElementById('mobile-menu-btn');
    const mobileSidebar = document.getElementById('mobile-sidebar');
    
    if (mobileMenuBtn && mobileSidebar) {
        mobileMenuBtn.addEventListener('click', () => {
            mobileSidebar.classList.toggle('hidden');
        });
        
        mobileSidebar.addEventListener('click', (e) => {
            if (e.target === mobileSidebar) {
                mobileSidebar.classList.add('hidden');
            }
        });
    }
</script>

</body>
</html>